{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block title %}Profile | {{ user.username }}{% endblock %}

{% block content %}
<div class="min-h-screen relative overflow-x-hidden font-sans">
    
    <!-- Deep Space Background -->
    <div class="fixed inset-0 z-0">
        <div class="absolute inset-0 bg-black"></div>
        <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-black to-black opacity-80"></div>
        <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-20"></div>
        <!-- Subtle moving nebula effect -->
        <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-purple-900/10 blur-[120px] rounded-full mix-blend-screen animate-pulse duration-[10s]"></div>
        <div class="absolute bottom-0 left-0 w-[600px] h-[600px] bg-blue-900/10 blur-[120px] rounded-full mix-blend-screen animate-pulse duration-[15s]"></div>
    </div>

    <!-- Navigation Bar (Simple for now, matching theme) -->
    <nav class="relative z-50 border-b border-white/5 bg-black/50 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <a href="/" class="font-display font-bold text-2xl text-white tracking-wider hover:text-orange-500 transition-colors">
                        EVENT<span class="text-orange-500">HORIZON</span>
                    </a>
                </div>
                <div class="flex items-center gap-6">
                    <a href="{% url 'event-list' %}" class="text-sm font-medium text-gray-400 uppercase tracking-wider hover:text-white transition-colors">
                        Missions
                    </a>
                    {% if user.is_staff %}
                    <a href="{% url 'admin:index' %}" class="text-sm font-medium text-gray-400 uppercase tracking-wider hover:text-white transition-colors">
                        Admin
                    </a>
                    {% endif %}
                    <form method="post" action="{% url 'account_logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="text-xs font-medium text-red-400 hover:text-red-300 uppercase tracking-wider transition-colors border border-red-900/30 hover:bg-red-900/20 px-3 py-1.5 rounded">
                            {% trans "Abort Session" %}
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Grid -->
    <main class="relative z-10 max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- LEFT COLUMN: Identity Card (3 cols) -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- Profile Card -->
                <div class="group relative bg-gray-900/40 backdrop-blur-md rounded-2xl border border-white/5 overflow-hidden transition-all hover:border-white/10">
                    <!-- Decorative header line -->
                    <div class="h-1 w-full bg-gradient-to-r from-orange-500 via-red-500 to-purple-600"></div>
                    
                    <div class="p-8 flex flex-col items-center text-center">
                        
                        <!-- Avatar -->
                        <div class="relative w-32 h-32 mb-6">
                            <!-- Animated rings -->
                            <div class="absolute inset-0 rounded-full border border-white/10 animate-[spin_10s_linear_infinite]"></div>
                            <div class="absolute -inset-2 rounded-full border border-dashed border-white/5 animate-[spin_15s_linear_infinite_reverse]"></div>
                            
                            <div class="w-full h-full rounded-full overflow-hidden border-2 border-gray-800 bg-black relative z-10 shadow-2xl">
                                {% if user.profile.avatar %}
                                    <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}" class="w-full h-full object-cover">
                                {% else %}
                                    <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-800 to-gray-900 text-gray-600">
                                        <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Status Indicator -->
                            <div class="absolute bottom-1 right-1 w-4 h-4 rounded-full bg-green-500 border-2 border-black z-20 shadow-[0_0_10px_rgba(34,197,94,0.5)]"></div>
                        </div>

                        <!-- Name & Role -->
                        <h2 class="text-3xl font-display font-bold text-white tracking-wide mb-1">{{ user.username }}</h2>
                        <div class="flex items-center gap-2 mb-6">
                            {% if user.is_superuser %}
                                <span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-widest bg-orange-500/10 text-orange-400 border border-orange-500/20">Fleet Commander</span>
                            {% else %}
                                <span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-widest bg-blue-500/10 text-blue-400 border border-blue-500/20">Explorer</span>
                            {% endif %}
                        </div>

                        <!-- Quick Stats Grid -->
                        <div class="grid grid-cols-2 gap-4 w-full border-t border-white/5 pt-6 mt-2">
                             <div class="text-center">
                                <span class="block text-2xl font-display font-semibold text-white">0</span>
                                <span class="text-xs text-gray-500 uppercase tracking-wider">Missions</span>
                            </div>
                            <div class="text-center border-l border-white/5">
                                <span class="block text-2xl font-display font-semibold text-white">1</span>
                                <span class="text-xs text-gray-500 uppercase tracking-wider">Level</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Info Panel -->
                <div class="bg-gray-900/40 backdrop-blur-md rounded-2xl border border-white/5 p-6 space-y-5">
                    <h3 class="text-sm font-display font-semibold text-gray-400 uppercase tracking-widest flex items-center gap-2">
                        <svg class="w-4 h-4 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Personnel Data
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-start justify-between group">
                            <span class="text-sm text-gray-500">Full Name</span>
                            <span class="text-sm text-gray-200 font-medium text-right">{{ user.first_name }} {{ user.last_name }}</span>
                        </div>
                        <div class="flex items-start justify-between group">
                            <span class="text-sm text-gray-500">Email</span>
                            <span class="text-sm text-gray-200 font-medium text-right break-all">{{ user.email }}</span>
                        </div>
                         {% if user.profile.location %}
                        <div class="flex items-start justify-between group">
                            <span class="text-sm text-gray-500">Location</span>
                            <span class="text-sm text-gray-200 font-medium text-right">{{ user.profile.location }}</span>
                        </div>
                        {% endif %}
                        {% if user.profile.phone_number %}
                        <div class="flex items-start justify-between group">
                            <span class="text-sm text-gray-500">Uplink</span>
                            <span class="text-sm text-gray-200 font-medium text-right">{{ user.profile.phone_number }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- External Links (Read Only View) -->
                {% if user.social_links.exists %}
                <div class="bg-gray-900/40 backdrop-blur-md rounded-2xl border border-white/5 p-6">
                    <h3 class="text-sm font-display font-semibold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                         <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
                        Network Nodes
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        {% for link in user.social_links.all %}
                        <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/5 hover:border-white/20 hover:bg-white/10 transition-all text-xs font-medium text-gray-300 hover:text-white">
                            {{ link.get_platform_display }}
                            <svg class="w-3 h-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

            </div>

            <!-- RIGHT COLUMN: Edit Form & Bio (8 cols) -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Bio Card -->
                <div class="bg-gray-900/40 backdrop-blur-md rounded-2xl border border-white/5 p-8 relative overflow-hidden">
                     <div class="absolute top-0 right-0 p-8 opacity-5">
                        <svg class="w-32 h-32 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M14.017 21L14.017 18C14.017 16.8954 13.1216 16 12.017 16H5.98295C4.87839 16 3.98295 16.8954 3.98295 18L3.98295 21H2V18C2 15.7909 3.79086 14 5.98295 14H12.017C14.2091 14 16.017 15.7909 16.017 18V21H14.017ZM12 13C12 13 12 13 12 13C12 13 12 13 12 13C12 13 12 13 12 13C12 13 12 13 12 13C9.23858 13 7 10.7614 7 8C7 5.23858 9.23858 3 12 3C14.7614 3 17 5.23858 17 8C17 10.7614 14.7614 13 12 13ZM12 11C13.6569 11 15 9.65685 15 8C15 6.34315 13.6569 5 12 5C10.3431 5 9 6.34315 9 8C9 9.65685 10.3431 11 12 11ZM18 10V10.1972C18.6366 10.0694 19.3032 10 20 10V18C20 19.8822 18.6946 21.4589 16.9201 21.8906C16.8286 21.3653 16.5925 20.8845 16.2575 20.4851C17.2929 20.129 18 19.1672 18 18V10ZM20 8C20 5.23858 17.7614 3 15 3V5C16.6569 5 18 6.34315 18 8Z"></path></svg>
                    </div>

                    <h3 class="text-xl font-display font-bold text-white mb-4">Mission Log</h3>
                    <div class="prose prose-invert max-w-none text-gray-300 leading-relaxed font-light">
                        {% if user.profile.bio %}
                            {{ user.profile.bio|linebreaks }}
                        {% else %}
                            <p class="text-gray-500 italic">No mission logs recorded. Update your profile to add a biography.</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Edit Form -->
                <div class="bg-gray-900/40 backdrop-blur-md rounded-2xl border border-white/5 overflow-hidden">
                    <div class="p-6 border-b border-white/5 bg-white/5 flex items-center justify-between">
                         <h3 class="text-lg font-display font-bold text-white">Update Credentials</h3>
                         <span class="text-xs text-gray-500 uppercase tracking-widest">Secure Access</span>
                    </div>

                    <div class="p-8">
                        <form method="POST" enctype="multipart/form-data" class="space-y-8">
                            {% csrf_token %}
                            
                            <!-- Personal Info Section -->
                            <div>
                                <h4 class="text-xs font-bold text-orange-500 uppercase tracking-widest mb-6 border-b border-orange-500/20 pb-2 inline-block">Personal Information</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="space-y-1">
                                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wide">First Name</label>
                                        {{ u_form.first_name }}
                                    </div>
                                    <div class="space-y-1">
                                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wide">Last Name</label>
                                        {{ u_form.last_name }}
                                    </div>
                                    <div class="space-y-1 md:col-span-2">
                                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wide">Email Address</label>
                                        {{ u_form.email }}
                                    </div>
                                </div>
                            </div>

                            <!-- Meta Data Section -->
                             <div>
                                <h4 class="text-xs font-bold text-blue-500 uppercase tracking-widest mb-6 border-b border-blue-500/20 pb-2 inline-block">Meta Data</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="space-y-1">
                                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wide">Sector / Location</label>
                                        {{ p_form.location }}
                                    </div>
                                    <div class="space-y-1">
                                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wide">Comms Uplink / Phone</label>
                                        {{ p_form.phone_number }}
                                    </div>
                                    <div class="space-y-1 md:col-span-2">
                                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wide">Hologram / Avatar</label>
                                        <div class="flex items-center gap-4 p-4 rounded-lg border border-white/5 bg-black/20">
                                            {{ p_form.avatar }}
                                        </div>
                                    </div>
                                    <div class="space-y-1 md:col-span-2">
                                        <label class="text-xs font-medium text-gray-400 uppercase tracking-wide">Mission Log / Bio</label>
                                        {{ p_form.bio }}
                                    </div>
                                </div>
                            </div>

                            <!-- Social Links Section -->
                            <div>
                                <h4 class="text-xs font-bold text-purple-500 uppercase tracking-widest mb-6 border-b border-purple-500/20 pb-2 inline-block">Neural Network Links</h4>
                                {{ s_formset.management_form }}
                                <div class="space-y-4">
                                    {% for form in s_formset %}
                                        <div class="flex flex-col sm:flex-row gap-4 p-4 rounded-lg border border-white/5 bg-white/5 hover:border-white/10 transition-colors">
                                            <div class="w-full sm:w-1/3 space-y-1">
                                                <label class="text-[10px] font-medium text-gray-500 uppercase tracking-wide">Platform</label>
                                                {{ form.platform }}
                                            </div>
                                            <div class="w-full space-y-1">
                                                <label class="text-[10px] font-medium text-gray-500 uppercase tracking-wide">URL Endpoint</label>
                                                {{ form.url }}
                                            </div>
                                            <div class="hidden">
                                                {{ form.id }}
                                                {{ form.DELETE }}
                                            </div>
                                            {% if form.instance.pk %}
                                            <div class="flex items-end pb-1">
                                                <div class="text-xs text-red-400 flex items-center gap-1">
                                                    <input type="checkbox" name="{{ form.DELETE.html_name }}" id="{{ form.DELETE.id_for_label }}" class="rounded border-gray-600 bg-black/50 text-red-500 focus:ring-red-500">
                                                    <label for="{{ form.DELETE.id_for_label }}">Delete</label>
                                                </div>
                                            </div>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="pt-6 flex items-center justify-end gap-4 border-t border-white/5">
                                <a href="{% url 'account_email' %}" class="text-sm text-gray-400 hover:text-white transition-colors">Manage Emails</a>
                                <button type="submit" class="px-8 py-3 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-500 hover:to-red-500 text-white font-medium rounded-lg shadow-lg shadow-orange-900/20 transition-all hover:scale-[1.02] active:scale-[0.98]">
                                    Update Profile
                                </button>
                            </div>

                        </form>
                    </div>
                </div>

            </div>
        </div>
    </main>
</div>
{% endblock %}
